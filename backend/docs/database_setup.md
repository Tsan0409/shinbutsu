# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## ðŸ“‹ æ¦‚è¦
ç¥žä»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹æ‰‹é †ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

---

## ðŸ—‚ï¸ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
backend/postgres/
â”œâ”€â”€ docker-compose.yml           # PostgreSQLã‚³ãƒ³ãƒ†ãƒŠå®šç¾©
â””â”€â”€ initdb/                      # åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆè‡ªå‹•å®Ÿè¡Œï¼‰
    â”œâ”€â”€ 00_DEMO_CUSTOMER.sql     # ãƒ‡ãƒ¢ç”¨ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    â”œâ”€â”€ 01_DDL_CREATE_TABLE.sql  # ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
    â””â”€â”€ 02_DML_INSERT_INIT_DATA.sql # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
```

---

## ðŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. PostgreSQLã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•

```bash
cd backend/postgres
docker-compose up -d
```

### 2. åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è‡ªå‹•å®Ÿè¡Œ

ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã€`initdb/`å†…ã®SQLãƒ•ã‚¡ã‚¤ãƒ«ãŒ**è¾žæ›¸é †**ã§è‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

1. `00_DEMO_CUSTOMER.sql` - ãƒ‡ãƒ¢ç”¨Customerãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
2. `01_DDL_CREATE_TABLE.sql` - MVPç”¨7ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
3. `02_DML_INSERT_INIT_DATA.sql` - ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥

### 3. æŽ¥ç¶šç¢ºèª

```bash
# psqlã§æŽ¥ç¶š
docker exec -it postgres_container psql -U appuser -d app_db

# ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ç¢ºèª
SHOW timezone;
-- çµæžœ: Asia/Tokyo

# ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§
\dt

# ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç¢ºèª
SELECT * FROM period;
SELECT * FROM temple;
```

---

## ðŸ”§ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä»•æ§˜

### æŽ¥ç¶šæƒ…å ±

| é …ç›® | å€¤ |
|-----|-----|
| ãƒ›ã‚¹ãƒˆ | localhost |
| ãƒãƒ¼ãƒˆ | 5431 |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å | app_db |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼å | appuser |
| ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | appuser |
| ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ | Asia/Tokyo |

### ç’°å¢ƒå¤‰æ•°

```yaml
environment:
  TZ: "Asia/Tokyo"              # ã‚·ã‚¹ãƒ†ãƒ ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
  PGTZ: "Asia/Tokyo"            # PostgreSQLå°‚ç”¨ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
  POSTGRES_USER: appuser
  POSTGRES_PASSWORD: appuser
  POSTGRES_DB: app_db
```

---

## ðŸ“Š ä½œæˆã•ã‚Œã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆMVPç‰ˆï¼‰

| No | ãƒ†ãƒ¼ãƒ–ãƒ«å | èª¬æ˜Ž | ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° |
|----|-----------|------|----------|
| 1 | period | æ™‚ä»£ãƒžã‚¹ã‚¿ | 12ä»¶ |
| 2 | era | å…ƒå·ãƒžã‚¹ã‚¿ | 20ä»¶ |
| 3 | sect | å®—æ´¾ãƒžã‚¹ã‚¿ | 10ä»¶ |
| 4 | temple | å¯ºé™¢æƒ…å ± | 5ä»¶ |
| 5 | temple_article | å¯ºé™¢è¨˜äº‹ | 2ä»¶ |
| 6 | glossary_term | ç”¨èªžé›† | 8ä»¶ |
| 7 | article_term | è¨˜äº‹-ç”¨èªžé–¢é€£ | 5ä»¶ |

**åˆè¨ˆ**: 62ä»¶ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

---

## ðŸŽ¯ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å†…å®¹

### æ™‚ä»£ï¼ˆ12ä»¶ï¼‰
é£›é³¥æ™‚ä»£ã€å¥ˆè‰¯æ™‚ä»£ã€å¹³å®‰æ™‚ä»£ã€éŽŒå€‰æ™‚ä»£ã€å®¤ç”ºæ™‚ä»£ã€å®‰åœŸæ¡ƒå±±æ™‚ä»£ã€æ±Ÿæˆ¸æ™‚ä»£ã€æ˜Žæ²»æ™‚ä»£ã€å¤§æ­£æ™‚ä»£ã€æ˜­å’Œæ™‚ä»£ã€å¹³æˆæ™‚ä»£ã€ä»¤å’Œæ™‚ä»£

### å…ƒå·ï¼ˆ20ä»¶ï¼‰
å¯›æ°¸ã€å»¶å®ã€å…ƒç¦„ã€äº«ä¿ã€å¯›æ”¿ã€æ–‡åŒ–ã€æ–‡æ”¿ã€å¤©ä¿ã€å¼˜åŒ–ã€å˜‰æ°¸ã€å®‰æ”¿ã€ä¸‡å»¶ã€æ–‡ä¹…ã€å…ƒæ²»ã€æ…¶å¿œã€æ˜Žæ²»ã€å¤§æ­£ã€æ˜­å’Œã€å¹³æˆã€ä»¤å’Œ

### å®—æ´¾ï¼ˆ10ä»¶ï¼‰
å¤©å°å®—ã€çœŸè¨€å®—ã€æµ„åœŸå®—ã€æµ„åœŸçœŸå®—ã€è‡¨æ¸ˆå®—ã€æ›¹æ´žå®—ã€æ—¥è“®å®—ã€æ™‚å®—ã€é»„æª—å®—ã€å¾‹å®—

### å¯ºé™¢ï¼ˆ5ä»¶ï¼‰
- æ¸…æ°´å¯ºï¼ˆäº¬éƒ½ï¼‰
- é‡‘é–£å¯º/é¹¿è‹‘å¯ºï¼ˆäº¬éƒ½ï¼‰
- æ±å¤§å¯ºï¼ˆå¥ˆè‰¯ï¼‰
- é‡‘å‰›å³¯å¯ºï¼ˆå’Œæ­Œå±±ãƒ»é«˜é‡Žå±±ï¼‰
- æµ…è‰å¯ºï¼ˆæ±äº¬ï¼‰

### ç”¨èªžï¼ˆ8ä»¶ï¼‰
è¦³éŸ³è©è–©ã€ä»çŽ‹åƒã€äº”é‡å¡”ã€æœ¬å ‚ã€å¾¡æœ±å°ã€å¿œä»ã®ä¹±ã€é–‹å±±ã€ç¦…å®—

---

## ðŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒªã‚»ãƒƒãƒˆ

### æ–¹æ³•1: ã‚³ãƒ³ãƒ†ãƒŠã®å†ä½œæˆï¼ˆæŽ¨å¥¨ï¼‰

```bash
# ã‚³ãƒ³ãƒ†ãƒŠã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å‰Šé™¤
cd backend/postgres
docker-compose down -v

# å†èµ·å‹•ï¼ˆåˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå†å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
docker-compose up -d
```

### æ–¹æ³•2: æ‰‹å‹•ã§DROP/CREATE

```bash
# ã‚³ãƒ³ãƒ†ãƒŠã«æŽ¥ç¶š
docker exec -it postgres_container psql -U appuser -d app_db

# ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤ï¼ˆé †åºã«æ³¨æ„ï¼‰
DROP TABLE IF EXISTS article_term CASCADE;
DROP TABLE IF EXISTS glossary_term CASCADE;
DROP TABLE IF EXISTS temple_article CASCADE;
DROP TABLE IF EXISTS temple CASCADE;
DROP TABLE IF EXISTS sect CASCADE;
DROP TABLE IF EXISTS era CASCADE;
DROP TABLE IF EXISTS period CASCADE;

# DDLã‚’å†å®Ÿè¡Œ
\i /docker-entrypoint-initdb.d/01_DDL_CREATE_TABLE.sql
\i /docker-entrypoint-initdb.d/02_DML_INSERT_INIT_DATA.sql
```

---

## ðŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒãƒ¼ãƒˆ5431ãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹

```bash
# ä½¿ç”¨ä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
lsof -i :5431

# docker-compose.ymlã®ãƒãƒ¼ãƒˆã‚’å¤‰æ›´
ports:
  - 5432:5432  # 5431â†’5432ã«å¤‰æ›´
```

### åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã•ã‚Œãªã„

**åŽŸå› **: ãƒœãƒªãƒ¥ãƒ¼ãƒ ã«æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã£ã¦ã„ã‚‹

**è§£æ±º**:
```bash
# ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å‰Šé™¤ã—ã¦å†ä½œæˆ
docker-compose down -v
docker-compose up -d
```

### ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãŒ UTC ã®ã¾ã¾

**ç¢ºèª**:
```sql
SHOW timezone;  -- Asia/Tokyoã§ã‚ã‚‹ã“ã¨
SELECT NOW();   -- æ—¥æœ¬æ™‚é–“ã§ã‚ã‚‹ã“ã¨
```

**è§£æ±º**: docker-compose.ymlã«ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
```yaml
environment:
  TZ: "Asia/Tokyo"
  PGTZ: "Asia/Tokyo"
```

---

## ðŸ“ é–‹ç™ºæ™‚ã®Tips

### pgAdminã§ã®æŽ¥ç¶š

1. pgAdminã‚’èµ·å‹•
2. æ–°ã—ã„ã‚µãƒ¼ãƒãƒ¼ã‚’è¿½åŠ :
   - Host: localhost
   - Port: 5431
   - Database: app_db
   - Username: appuser
   - Password: appuser

### VSCodeã§ã®æŽ¥ç¶š

1. æ‹¡å¼µæ©Ÿèƒ½ã€ŒPostgreSQLã€ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. æŽ¥ç¶šæƒ…å ±ã‚’å…¥åŠ›:
   ```
   postgresql://appuser:appuser@localhost:5431/app_db
   ```

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

```bash
# ãƒ€ãƒ³ãƒ—ä½œæˆ
docker exec postgres_container pg_dump -U appuser app_db > backup.sql

# ãƒªã‚¹ãƒˆã‚¢
docker exec -i postgres_container psql -U appuser app_db < backup.sql
```

---

## ðŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸](./database_design.md) - è©³ç´°ãªãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
- [README_API.md](../README_API.md) - APIä»•æ§˜æ›¸
- [memo.md](../../memo.md) - è¦ä»¶å®šç¾©

---

## ðŸ“… æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|------|---------|
| 2026-01-22 | åˆç‰ˆä½œæˆ |
